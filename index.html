<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>Mapa de Envueltos Tradicionales del Ecuador</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
  font-family: "Segoe UI", Roboto, Arial, sans-serif;
  background: #f4f6f8;
  margin: 0;
  color: #111;
}
main {
  max-width: 1100px;
  margin: auto;
  padding: 1rem;
}
h1 {
  font-size: 1.8rem;
  margin: 0.5rem 0;
  text-align: center;
}
section {
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 12px;
  padding: 1rem;
  margin: 1rem 0;
}
fieldset {
  border: 1px dashed #ccc;
  border-radius: 10px;
  padding: 1rem;
  margin: 1rem 0;
}
legend {
  font-weight: 700;
}
label {
  display: block;
  margin: 0.4rem 0 0.2rem;
}
input[type=text], input[type=number], select, textarea {
  width: 100%;
  padding: 0.5rem;
  border: 1px solid #ccc;
  border-radius: 8px;
}
textarea {
  min-height: 80px;
}
.inline {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  margin-top: 0.5rem;
}
.chip {
  display: inline-flex;
  align-items: center;
  gap: 0.3rem;
  border: 1px solid #ccc;
  border-radius: 999px;
  padding: 0.35rem 0.6rem;
  background: #f9fafb;
  transition: background 0.3s, border 0.3s, color 0.3s;
  font-weight: 500;
  cursor: pointer;
}
.chip input {
  accent-color: #0284c7;
}
.envuelto-card {
  border: 2px solid #bcdffb;
  border-radius: 12px;
  padding: 1rem;
  margin: 1rem 0;
  color: #111;
}
button {
  background: #0284c7;
  color: #fff;
  border: none;
  padding: 0.7rem 1.1rem;
  border-radius: 10px;
  cursor: pointer;
  margin-top: 1rem;
  font-weight: 600;
  font-size: 1rem;
}
button:hover {
  background: #0369a1;
}
.note {
  color: #666;
  font-size: 0.9rem;
  margin-top: 8px;
  text-align: center;
}
img.banner {
  width: 100%;
  border-radius: 10px;
  margin: 1rem 0;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}
#consentimiento {
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 12px;
  padding: 2rem;
  text-align: center;
  margin-top: 2rem;
}
#consentimiento button {
  margin: 0.5rem;
}
.hidden {
  display: none;
}
</style>
</head>
<body>
<main>

<!-- Pantalla de consentimiento -->
<div id="consentimiento">
  <h1>Mapa de Envueltos Tradicionales del Ecuador</h1>
  <img src="https://uploads.vibra.co/1/2021/09/como-hacer-envueltos-de-mazorca.jpg" alt="Envueltos tradicionales" class="banner">
  <p><strong>Cuestionario de entrevista semiestructurada</strong></p>
  <p>La información recabada será utilizada exclusivamente con fines académicos y de investigación. Todos los datos proporcionados serán tratados de manera confidencial y no se divulgará información personal fuera del contexto de este estudio.</p>
  <p>¿Desea continuar con la encuesta?</p>
  <button id="btnAceptar">Sí, deseo participar</button>
  <button id="btnRechazar" style="background:#ccc;color:#000;">No deseo participar</button>
</div>

<!-- Formulario principal -->
<form id="encuesta" class="hidden">
  <section>
    <h2>Datos generales</h2>
    <div class="inline" style="flex-direction: column;">
      <label>Nombres completos *</label><input type="text" name="nombres" required>
      <label>Edad *</label><input type="number" name="edad" required>
      <label>Género *</label>
      <select name="genero" required>
        <option value="">Seleccione</option>
        <option>Femenino</option>
        <option>Masculino</option>
        <option>Otro</option>
      </select>
      <label>Región *</label>
      <select name="region" required>
        <option value="">Seleccione</option>
        <option>Costa</option>
        <option>Sierra</option>
        <option>Amazonía</option>
        <option>Insular</option>
      </select>
      <label>Provincia *</label><input type="text" name="provincia" required>
      <label>Ciudad *</label><input type="text" name="ciudad" required>
      <label>Actividad principal/laboral *</label>
      <select name="actividad" required>
        <option value="">Seleccione</option>
        <option>Cocinero/a tradicional</option>
        <option>Docente de gastronomía</option>
        <option>Promotor/a cultural</option>
        <option>Chef</option>
      </select>
      <label>Tiempo de experiencia *</label>
      <input type="text" name="experiencia" required>
    </div>
  </section>

  <section>
    <h2>Información de los envueltos</h2>
    <p>Seleccione los envueltos que conoce o prepara:</p>
    <div id="lista-envueltos" class="inline"></div>
    <div id="contenedor-envueltos"></div>
  </section>

  <button type="submit" id="btnEnviar">Enviar respuestas</button>
  <div class="note">Tenga paciencia, el envío puede tardar algunos segundos.</div>
</form>

</main>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbzTdjIHxfGDPEQHWlmjakXSVP_YKfbAVO8LIOT9tFuPg05_NSPgsYkbbrcbS45W4fKx/exec";

const ENVUELTOS = [
  "Humita","Chigüil","Tamal lojano","Tamales Pelileo","Tamal de mote","Tamales de zambo",
  "Bollo de pescado","Tonga manaba","Tonga marinera","Maito de pescado","Maito de gallina",
  "Maito de chontacuro","Pescado moqueado / ahumado","Ayampaco","Dulce de guineo",
  "Chivil","Vincundo / Putsucutanda","Arepa de zapallo","Timbulo","Quimbolito","Otros"
];
const colores = ["color-1","color-2","color-3","color-4","color-5","color-6","color-7"];
const lista = document.getElementById("lista-envueltos");
const contenedor = document.getElementById("contenedor-envueltos");
ENVUELTOS.forEach((n,i)=>{
  const lbl=document.createElement("label");
  lbl.className="chip";
  lbl.innerHTML=`<input type="checkbox" value="${n}"><span>${n}</span>`;
  lista.appendChild(lbl);
});
lista.addEventListener("change",()=>{
  contenedor.innerHTML="";
  const seleccionados=[...lista.querySelectorAll("input:checked")].map(c=>c.value);
  seleccionados.forEach((nombre,i)=>{
    const div=document.createElement("div");
    div.className=`envuelto-card ${colores[i%colores.length]}`;
    let otrosExtra = "";
    if(nombre==="Otros"){
      otrosExtra = `<label>Especifique el nombre del otro envuelto:</label><input type="text" name="otro_nombre_${i}" required>`;
    }
    div.innerHTML=`
      <fieldset><legend>${nombre}</legend>
        ${otrosExtra}
        <label>1. Tipo de masa/base:</label>
        <textarea name="masa_${nombre}"></textarea>
        <label>2. Relleno que se utiliza:</label>
        <textarea name="relleno_${nombre}"></textarea>
        <label>3. Tipo de hoja que se usa:</label>
        <textarea name="hoja_${nombre}"></textarea>
        <label>4. Técnica de cocción que se usa:</label>
        <textarea name="coccion_${nombre}"></textarea>
        <label>5. Herramienta que se usa:</label>
        <textarea name="herramienta_${nombre}"></textarea>
        <label>6. Formas de transmitir estos conocimientos:</label>
        <textarea name="transmision_${nombre}"></textarea>
        <label>7. Contexto en que se prepara:</label>
        <textarea name="contexto_${nombre}"></textarea>
      </fieldset>`;
    contenedor.appendChild(div);
  });
});

// === ENVÍO ===
const form=document.getElementById("encuesta");
form.addEventListener("submit", e=>{
  e.preventDefault();
  const btn=document.getElementById("btnEnviar");
  btn.disabled=true;
  btn.textContent="⏳ Enviando respuestas… por favor espere";
  const formData=new FormData(form);
  fetch(scriptURL,{method:"POST",body:formData})
  .then(()=>{
    alert("✅ ¡Gracias! Tus respuestas fueron enviadas correctamente.");
    btn.disabled=false;
    btn.textContent="Enviar respuestas";
    form.reset();
    contenedor.innerHTML="";
  })
  .catch(err=>{
    alert("❌ Error al enviar: "+err.message);
    btn.disabled=false;
    btn.textContent="Enviar respuestas";
  });
});

// === CONSENTIMIENTO ===
document.getElementById("btnAceptar").onclick=()=>{
  document.getElementById("consentimiento").classList.add("hidden");
  document.getElementById("encuesta").classList.remove("hidden");
};
document.getElementById("btnRechazar").onclick=()=>{
  alert("Gracias por su tiempo. No se registrarán datos.");
};
</script>
</body>
</html>
